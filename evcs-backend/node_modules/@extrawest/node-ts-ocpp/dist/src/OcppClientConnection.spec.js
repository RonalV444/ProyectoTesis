"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var OcppClientConnection_1 = require("./OcppClientConnection");
var globals_1 = require("@jest/globals");
var jest_websocket_mock_1 = require("jest-websocket-mock");
var Protocol_1 = require("./impl/Protocol");
globals_1.jest.mock("./impl/Client");
var ocppClCon = new OcppClientConnection_1.OcppClientConnection("testId");
var ws;
describe("Test Ocpp Client Connection methods", function () {
    beforeEach(function () {
        ws = new jest_websocket_mock_1.WS("ws://localhost:1234");
        ocppClCon = new OcppClientConnection_1.OcppClientConnection("testId");
    });
    it("Test method 'getCpId'. Should run method 'getCpId' correctly", function () {
        var fakeGetCpId = globals_1.jest.fn().mockReturnValue("testId");
        globals_1.jest.mock("./impl/Client", function () {
            return globals_1.jest.fn().mockImplementation(function () {
                return { getCpId: function () { return fakeGetCpId; } };
            });
        });
        ocppClCon.getCpId();
        expect(ocppClCon.getCpId).toBeCalled();
        expect(ocppClCon.getCpId).toBeCalledTimes(1);
    });
    it("Test method 'setConnection'. Should run method 'setConnection' correctly", function () {
        var spySetConnection = globals_1.jest.spyOn(ocppClCon, "setConnection");
        ocppClCon.setConnection(new Protocol_1.Protocol(ocppClCon, ws));
        expect(spySetConnection).toBeCalled();
        expect(spySetConnection).toBeCalledTimes(1);
        expect(spySetConnection).toBeCalledWith(new Protocol_1.Protocol(ocppClCon, ws));
    });
    it("Test method 'callRequest'. Should run method 'callRequest' correctly", function () {
        ocppClCon.callRequest("CancelReservation", { reservationId: 0 });
        expect(ocppClCon.callRequest).toBeCalled();
        expect(ocppClCon.callRequest).toBeCalledTimes(1);
        expect(ocppClCon.callRequest).toBeCalledWith("CancelReservation", { reservationId: 0 });
    });
    it("Test method 'on'. Should run method 'on' correctly", function () {
        globals_1.jest.spyOn(ocppClCon, "on");
        ocppClCon.on("BootNotification", globals_1.jest.fn());
        expect(ocppClCon.on).toBeCalled();
        expect(ocppClCon.on).toBeCalledTimes(1);
        expect(ocppClCon.on).toBeCalledWith("BootNotification", expect.any(Function));
    });
    afterEach(function () {
        globals_1.jest.clearAllMocks();
        ws.close();
    });
});
